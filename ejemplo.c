#include "petriNAME.c"

#define NAME_NUMERO_LUGARES 6
#define NAME_NUMERO_TRANSICIONES 7


struct transicion{
  unsigned char value;
  unsigned char sources[8];
  unsigned char sinks[8];
};

struct lugar{
  unsigned char value;
  char nombre[5];
  unsigned char marcaInicial;
};

struct PetriNAME{
  struct transicion Trans[NAME_NUMERO_TRANSICIONES];
  struct lugar Lugs[NAME_NUMERO_LUGARES];
};

struct PetriNAME _PetriNAME={
  {//trans
    {0,{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},
    {0,{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},
    {0,{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},
    {0,{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},
    {0,{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},
    {0,{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},
    {0,{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},
    {0,{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},
  },
  { //Lugs
    {0,"T120\0",0},
    {0,"T120\0",0},
    {0,"T120\0",0},
    {0,"T120\0",0},
    {0,"T120\0",0},
    {0,"T120\0",0},
    {0,"T120\0",0},
    {0,"T120\0",0},
    {0,"T120\0",0}
  }
};

void NAME_Reset(){
  unsigned char i;
  for(i=0; i<NAME_NUMERO_LUGARES; i++)
    _PetriNAME.Lugs[i].value=_PetriNAME.Lugs[i].marcaInicial;
}

void NAME_Step(){
  unsigned char i,j;
  char sensibilizada = 1;
  for(i=0; i<NAME_NUMERO_TRANSICIONES; i++){
    sensibilizada = 1;
    for(j=0;j<8 && (_PetriNAME.Trans[i].source[j] != 0xFF);j++){
      if(!_PetriNAME.Lugs[_PetriNAME.Trans[i].source[j]].value)
        sensibilizada=0;
    }
    if(sensibilizada && _PetriNAME.Trans[i].value){
      for(j=0;j<8 && (_PetriNAME.Trans[i].sink[j] != 0xFF);j++){
        _PetriNAME.Lugs[_PetriNAME.Trans[i].sink[j]].value=1;
      }
    }
  }
}

unsigned char NAME_strGetOput(char* name){
  unsigned char i;
  for(i=0; i<NAME_NUMERO_LUGARES; i++){
    if(!strcmp(name,_PetriNAME.Lugs[i].nombre))
      return PetriNAME.Lugs[i].value;
  }
}

void NAME_SetInput(unsigned char* arry){
  unsigned char i;
  for(i=0; i<NAME_NUMERO_TRANSICIONES; i++){
    _PetriNAME.Trans[i].value=arry[i];
  }
}
